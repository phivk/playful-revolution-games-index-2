---
phase: 04-deployment
plan: "03"
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified: []
autonomous: false
requirements: [DEPL-02]

must_haves:
  truths:
    - "Site is accessible at a public Vercel URL"
    - "GitHub OAuth Login button on /admin redirects to GitHub and completes successfully"
    - "Decap CMS admin interface loads at /admin after OAuth authentication"
  artifacts:
    - path: "vercel.json"
      provides: "Vercel build config (already created in Plan 01)"
    - path: "api/oauth/authorize.ts"
      provides: "OAuth authorize handler (already created in Plan 02)"
    - path: "api/auth/callback.ts"
      provides: "OAuth callback handler (already created in Plan 02)"
  key_links:
    - from: "Vercel dashboard"
      to: "GitHub repo"
      via: "Vercel Git integration import"
      pattern: "N/A (manual step)"
    - from: "Vercel environment variables"
      to: "api/auth/callback.ts"
      via: "GITHUB_CLIENT_ID and GITHUB_CLIENT_SECRET"
      pattern: "N/A (Vercel dashboard configuration)"
---

<objective>
Guide the user through the manual Vercel setup steps and verify the deployed site works end-to-end.

Purpose: The code and config are complete after Plans 01 and 02. The remaining work is inherently manual — creating a GitHub OAuth App and connecting the repository in Vercel dashboard are actions Claude cannot perform via CLI without Vercel authentication. This checkpoint ensures the user completes these steps and confirms the deployment works.

Output: Live site on Vercel + working Decap CMS admin with GitHub OAuth
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/04-deployment/04-CONTEXT.md
@.env.local.example
@public/admin/config.yml
</context>

<tasks>

<task type="checkpoint:human-action">
  <name>Task 1: Create GitHub OAuth App and connect Vercel project</name>
  <action>
    This is a manual checkpoint. No automated code changes are made in this task.

    Guide the user through the following one-time setup steps that require their GitHub and Vercel accounts.

    **Step 1: Create a GitHub OAuth App**

    1. Go to https://github.com/settings/developers
    2. Click "New OAuth App"
    3. Fill in:
       - Application name: `Playful Revolution Games CMS`
       - Homepage URL: `https://YOUR-PROJECT.vercel.app` (use a placeholder for now — update after Vercel assigns URL)
       - Authorization callback URL: `https://YOUR-PROJECT.vercel.app/api/auth/callback` (update after Vercel assigns URL)
    4. Click "Register application"
    5. Copy the **Client ID** and generate + copy the **Client Secret** (shown once only)

    **Step 2: Update config.yml with actual GitHub username**

    Open `public/admin/config.yml` and replace `YOUR-GITHUB-USERNAME` with the actual GitHub username:
    ```yaml
    backend:
      name: github
      repo: actual-username/playful-revolution-games-index-2
    ```
    Commit and push this change to `main`.

    **Step 3: Connect repo to Vercel**

    1. Go to https://vercel.com/new
    2. Import the GitHub repository (`playful-revolution-games-index-2`)
    3. Before clicking "Deploy", add Environment Variables:
       - `GITHUB_CLIENT_ID` = Client ID from Step 1 (Production scope)
       - `GITHUB_CLIENT_SECRET` = Client Secret from Step 1 (Production scope)
    4. Click "Deploy"

    **Step 4: Update GitHub OAuth App with real Vercel URL**

    After deploy, update the GitHub OAuth App Authorization callback URL to:
    `https://your-actual-vercel-url.vercel.app/api/auth/callback`
  </action>
  <verify>
    Vercel shows "Deployment Successful" and provides a live URL (e.g. https://playful-revolution-games-index-2.vercel.app)
  </verify>
  <done>
    Site is live on Vercel at a public URL. GitHub OAuth App exists with callback URL pointing to the Vercel deployment. Both GITHUB_CLIENT_ID and GITHUB_CLIENT_SECRET are set in Vercel environment variables.
  </done>
  <resume-signal>
    Type "deployed" when the site is live on Vercel, or describe any issues encountered.
  </resume-signal>
</task>

<task type="checkpoint:human-verify">
  <name>Task 2: Verify deployed site and CMS authentication</name>
  <action>
    This is a verification checkpoint. Ask the user to test the deployed site by following the how-to-verify steps.

    What was built in Plans 01 and 02:
    - `vercel.json` — Vercel build config with output directory and security headers
    - `api/oauth/authorize.ts` — GitHub OAuth redirect handler (Vercel serverless function)
    - `api/auth/callback.ts` — GitHub OAuth token exchange handler (Vercel serverless function)
    - Updated `public/admin/config.yml` — Decap CMS using GitHub backend with custom auth endpoint
    - `.env.local.example` — env var documentation

    Task 1 of this plan connected the repo to Vercel with environment variables set.
  </action>
  <verify>
    Test the following in order:

    **1. Static site loads:**
    - Visit `https://your-vercel-url.vercel.app`
    - Expected: Game catalog page loads, games visible, filter chips work

    **2. Game detail page loads:**
    - Click any game card
    - Expected: Game detail page opens at `/game/[slug]`, shows instructions

    **3. Admin page loads:**
    - Visit `https://your-vercel-url.vercel.app/admin`
    - Expected: Decap CMS login screen with "Login with GitHub" button

    **4. OAuth authentication completes:**
    - Click "Login with GitHub"
    - Expected: GitHub authorization page → click Authorize → redirected back to CMS editor

    **5. Games collection visible:**
    - In CMS, click "Games" in sidebar
    - Expected: Games list appears

    If OAuth fails: Check Vercel function logs at `https://vercel.com/dashboard` → project → Logs tab. Look for errors from `/api/oauth/authorize` or `/api/auth/callback`.

    If callback URL mismatch: Verify GitHub OAuth App Authorization callback URL matches exactly: `https://your-vercel-url.vercel.app/api/auth/callback`
  </verify>
  <done>
    Site loads at public Vercel URL. Game catalog, game detail pages, and /admin all render correctly. GitHub OAuth login flow completes and CMS editor is accessible with Games collection visible.
  </done>
  <resume-signal>Type "approved" if the site loads and GitHub OAuth completes successfully, or describe any issues.</resume-signal>
</task>

</tasks>

<verification>
1. Site loads at public Vercel URL
2. Game catalog and detail pages render correctly
3. `/admin` shows Decap CMS login screen
4. GitHub OAuth flow completes and CMS editor is accessible
5. Games collection visible in CMS admin
</verification>

<success_criteria>
- DEPL-01: Static site builds and deploys successfully (verified by site being live)
- DEPL-02: Site is accessible at public Vercel URL with working GitHub OAuth for CMS admin
- Facilitators can browse games at the public URL on mobile
- Admins with GitHub accounts can authenticate and manage games via /admin
</success_criteria>

<output>
After completion, create `.planning/phases/04-deployment/04-03-SUMMARY.md`
</output>
